<script>
    new Vue({
        el : "#app",
        data : {
            path: [],
            dir : {},
            cwd : {}
        },
        methods: {
            getLink : function(s){
                return s['loc'];
            },
            itemSize : function(s){
                if(s['size']) return s['size'];
                else{
                    function sumsize(o){
                        var total = 0;
                        Object.keys( o ).map(function( ri ){
                            var item = o[ri];
                            if(item['size']) total += +item['size'];
                            else total += sumsize( item );
                        })
                        return total;
                    }
                    return sumsize( s );
                }
            },
            isDir : function(s){
                if(s === "*" || !s['mtime']) return false;
                else return true;
            },
            getIcon : function(s){
                if(s === '*') return icon_arrow;
                if(s && !s['mtime']) return icon_folder;
                else return icon_file;
            },
            formatBytes: function (a, b) {
                if (0 === a) return "0 Bytes";
                var c = 1024, d = b || 2, e = ["Bytes", "KB", "MB", "GB", "TB", "PB", "EB", "ZB", "YB"],  f = Math.floor(Math.log(a) / Math.log(c));
                return parseFloat((a / Math.pow(c, f)).toFixed(d)) + " " + e[f];
            },
            travel : function(path){
                var current = this.dir;
                var valid   = true;
                for(var item in path){
                    if(current[path[item]]){
                        current = current[path[item]];
                        if(current['mtime']) valid = false;
                    } else valid = false;
                }
                return { valid : valid, obj : current, path : path };
            },
            nav : function(target){
                var temp = JSON.parse(JSON.stringify(this.path));
                if(target === "*") temp.splice(-1, 1);
                else temp.push(target);
                var response = this.travel( temp );
                if(response.valid === true){
                    this.path = response.path;
                    this.cwd = response.obj;
                }
            }
        },
        mounted : function(){
            this.$nextTick(function(){
                // Create Structure as we go
                for(var i = 0; i < D.length; i++){
                    var spl     = D[i].split("|").map(function(x){ return x.split("*"); });
                    var base    = spl.shift();
                    var lvls    = base[0].split("/");
                    var files   = {};
                    spl.map(function(item){
                        if(item[0] !== ""){
                            files[item[0].split("/").pop()] = {
                                name : item[0].split("/").pop(),
                                loc : item[0]
                                    .replace(/http:\//gi, 'http://')
                                    .replace(/https:\//gi, 'https://'),
                                mtime : item[1],
                                size : item[2]
                            };
                        }
                    })

                    lvls.shift();

                    var last = this.dir;

                    if(lvls.length === 0) this.dir = Object.assign(files, this.dir);
                    else{
                        for(var l = 0; l < lvls.length; l++){
                            if( !last[lvls[l]] ){
                                last[lvls[l]] = files;
                            }
                            last = last[lvls[l]];
                        }
                    }

                }

                this.cwd = this.dir;
            })
        },
        watch : {
            "dir" : {
                handler : function(){},
                deep : true
            }
        }
    })
</script>